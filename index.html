<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QRTurbo Code Generator</title>
    <!-- Favicon Configuration -->
    <link rel="icon" type="image/png" sizes="192x192" href="/android-chrome-192x192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="/android-chrome-512x512.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" href="/favicon.ico" type="image/x-icon">
    <link rel="manifest" href="/manifest.json">
    <style>
        /* --- Base & Body Styles --- */
        body {
            font-family: Arial, sans-serif;
            max-width: 600px;
            margin: 0 auto;
            padding: 20px;
            text-align: center;
            background-color: #f0f0f0;
            animation: fadeIn 0.8s ease-in-out; /* Initial page load animation */
        }

        /* --- Keyframe Animations --- */

        /* Fade-in animation for the body */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        h1 {
            animation: slideInDown 1s ease-out;
            color: #333;
            margin-bottom: 30px;
        }

        /* Slide-in animation for the main heading */
        @keyframes slideInDown {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- QR Code Container --- */
        #qr-container {
            margin-top: 20px;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            animation: slideInUp 0.8s ease-out 0.3s both; /* Delayed slide-in */
            transition: all 0.3s ease;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #qr-container:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        /* Slide-up animation for the QR container */
        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- Form Elements (Inputs, Buttons, Select) --- */
        input, button, select, textarea {
            font-size: 14px;
            margin: 10px 0;
            padding: 12px;
            width: 100%;
            box-sizing: border-box;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            transition: all 0.3s ease;
            animation: fadeInUp 0.6s ease-out 0.5s both; /* Staggered fade-in */
        }

        textarea {
            font-family: Arial, sans-serif; /* Ensure consistent font */
            resize: vertical; /* Allow vertical resizing only */
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #007acc;
            box-shadow: 0 0 0 3px rgba(0, 122, 204, 0.1);
            transform: scale(1.02);
        }


        /* Fade-up animation for form elements */
        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* --- Button Styles --- */
        button {
            background: linear-gradient(135deg, #007acc, #005a9e);
            color: white;
            border: none;
            cursor: pointer;
            font-weight: bold;
            position: relative; /* For pseudo-element positioning */
            overflow: hidden; /* Hides the ::before element outside the button */
        }

        button:hover {
            background: linear-gradient(135deg, #005a9e, #004080);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 122, 204, 0.3);
        }

        button:active {
            transform: translateY(0);
            box-shadow: 0 2px 8px rgba(0, 122, 204, 0.3);
        }

        /* Shimmer effect on button hover */
        button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }

        button:hover::before {
            left: 100%;
        }

        /* --- QR Image & Download Button --- */
        #qr-image {
            max-width: 100%;
            height: auto;
            margin-top: 20px;
            border-radius: 8px;
            transition: all 0.3s ease;
            animation: qrAppear 0.6s ease-out;
        }

        /* Animation for the QR code appearing */
        @keyframes qrAppear {
            from {
                opacity: 0;
                transform: scale(0.8) rotate(5deg);
            }
            to {
                opacity: 1;
                transform: scale(1) rotate(0deg);
            }
        }

        #qr-image:hover {
            transform: scale(1.05);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        #download-btn {
            display: none; /* Initially hidden */
            margin-top: 15px;
            background: linear-gradient(135deg, #28a745, #20c997);
            animation: bounceIn 0.6s ease-out;
        }

        #download-btn:hover {
            background: linear-gradient(135deg, #20c997, #17a2b8);
        }

        /* Bounce-in animation for the download button */
        @keyframes bounceIn {
            0% {
                opacity: 0;
                transform: scale(0.3);
            }
            50% {
                opacity: 1;
                transform: scale(1.05);
            }
            70% {
                transform: scale(0.9);
            }
            100% {
                opacity: 1;
                transform: scale(1);
            }
        }

        /* --- Character Counter --- */
        .char-counter {
            color: #666;
            font-size: 0.8em;
            margin-top: 5px;
            margin-bottom: 10px;
            text-align: right;
            animation: fadeIn 0.8s ease-out 0.7s both;
            transition: color 0.3s ease;
        }

        .char-counter.warning {
            color: #ff6b35;
            font-weight: bold;
            animation: pulse 1s ease-in-out;
        }

        /* Pulse animation for character count warning */
        @keyframes pulse {
            0%, 100% {
                transform: scale(1);
            }
            50% {
                transform: scale(1.05);
            }
        }

        /* --- Miscellaneous Styles --- */
        #size-select {
            background-color: white;
            cursor: pointer;
        }

        #size-select:hover {
            border-color: #007acc;
        }

        p {
            animation: fadeIn 1s ease-out 1s both;
        }

        a {
            transition: all 0.3s ease;
            text-decoration: none;
        }

        a:hover {
            color: #005a9e !important;
            text-decoration: underline;
        }

        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            text-align: left;
            font-size: 0.9em;
            color: #444;
            animation: fadeInUp 0.6s ease-out 0.5s both;
        }

        .input-group.full-width {
            grid-column: 1 / -1; /* Span across both columns in the grid */
        }

        /* --- Loading Spinner Animation --- */
        /* Applied to qr-container during generation */
        .loading {
            position: relative;
        }

        .loading::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 20px;
            height: 20px;
            margin: -10px 0 0 -10px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid #007acc;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* --- Responsive Design --- */
        /* Simplify animations on smaller screens */
        @media (max-width: 768px) {
            body {
                padding: 15px;
            }
            
            #qr-container {
                padding: 15px;
            }
            
            /* Disable hover transforms on touch devices to prevent sticky hover states */
            button:hover {
                transform: none;
            }
        }

        /* --- QR Code Data Display --- */
        #qr-code-text {
            font-size: 0.9em;
            color: #555;
            margin-top: 15px;
            word-wrap: break-word;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 5px;
            border: 1px solid #eee;
            animation: fadeIn 0.5s ease-out;
        }

        #qr-placeholder {
            color: #888;
            margin-top: 20px;
            padding: 20px 0;
        }

        /* --- Tab Navigation Styles --- */
        #tabs {
            display: flex;
            margin-bottom: 20px;
            gap: 10px;
            animation: fadeIn 0.8s ease-in-out;
        }

        .tab-link {
            background: #fff;
            color: #333;
            border: 2px solid #e0e0e0;
            outline: none;
            cursor: pointer;
            padding: 12px 16px;
            font-size: 16px;
            transition: all 0.3s ease;
            margin: 0;
            width: auto;
            box-sizing: border-box;
            border-radius: 8px;
            font-weight: bold;
            position: relative;
        }
        
        .tab-link:hover:not(.active) {
            border-color: #aaa;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
        }
        
        .tab-link.active {
            background: linear-gradient(135deg, #28a745, #20c997);
            color: white;
            border-color: transparent;
            box-shadow: 0 4px 10px rgba(40, 167, 69, 0.3);
        }

        .tab-link.active:hover {
             background: linear-gradient(135deg, #20c997, #17a2b8);
             transform: translateY(-2px);
             box-shadow: 0 6px 15px rgba(32, 201, 151, 0.4);
        }

        .tab-content {
            display: none; /* Hidden by default, shown via JS */
            animation: fadeIn 0.5s;
        }

        /* --- vCard Form Grid Layout --- */
        .vcard-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        /* No extra margin needed for inputs inside the grid; gap property handles spacing */
        .vcard-grid input {
             margin: 0;
        }

        /* --- Layout Groups & Checkboxes --- */
        .input-group {
            display: flex;
            flex-direction: column;
        }

        .checkbox-group {
            flex-direction: row;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }
        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin: 0;
            animation: none; /* No need to animate tiny checkboxes */
        }
        .checkbox-group label {
            display: inline; /* Override block display */
            margin: 0;
            font-weight: normal;
            animation: none;
        }

        /* --- Radio Button Group Styles --- */
        .radio-group-container {
            display: flex;
            flex-direction: row;
            gap: 20px;
            align-items: center;
            margin-bottom: 10px;
            grid-column: 1 / -1; /* Span full width in grid */
        }

        .radio-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .radio-group input[type="radio"] {
            width: auto;
            margin: 0;
            animation: none;
            cursor: pointer;
        }

        .radio-group label {
            cursor: pointer;
        }
    </style>
</head>
<body>
    <h1>QRTurbo Code Generator</h1>

    <!-- Tab navigation for switching between QR code types -->
    <div id="tabs">
        <button class="tab-link active" data-tab="URLText">URL/Text</button>
        <button class="tab-link" data-tab="VCard">vCard</button>
        <button class="tab-link" data-tab="SMSPhone">SMS/Phone</button>
        <button class="tab-link" data-tab="Wifi">Wifi</button>
    </div>

    <!-- Tab Content: URL/Text Input -->
    <div id="URLText" class="tab-content" style="display: block;">
        <label for="qr-text">Text or URL</label>
        <input type="text" id="qr-text" placeholder="e.g., https://www.example.com" maxlength="300">
        <div id="char-count" class="char-counter">0 / 300 characters</div>
    </div>

    <!-- Tab Content: vCard Input Form -->
    <div id="VCard" class="tab-content">
        <div class="vcard-grid">
            <div class="input-group">
                <!-- vCard Fields -->
                <label for="vcard-fn">First Name</label>
                <input type="text" id="vcard-fn" placeholder="John" maxlength="50">
            </div>
            <div class="input-group">
                <label for="vcard-ln">Last Name</label>
                <input type="text" id="vcard-ln" placeholder="Appleseed" maxlength="50">
            </div>
            <div class="input-group">
                <label for="vcard-org">Organization</label>
                <input type="text" id="vcard-org" placeholder="ACME Inc." maxlength="100">
            </div>
            <div class="input-group">
                <label for="vcard-title">Title</label>
                <input type="text" id="vcard-title" placeholder="Developer" maxlength="100">
            </div>
            <div class="input-group">
                <label for="vcard-tel-work">Phone (Work)</label>
                <input type="tel" id="vcard-tel-work" placeholder="+1-555-555-1234" maxlength="30">
            </div>
            <div class="input-group">
                <label for="vcard-tel-mobile">Phone (Mobile)</label>
                <input type="tel" id="vcard-tel-mobile" placeholder="+1-555-555-5678" maxlength="30">
            </div>
            <div class="input-group full-width">
                <label for="vcard-email">Email</label>
                <input type="email" id="vcard-email" placeholder="john.appleseed@example.com" maxlength="254">
            </div>
            <div class="input-group full-width">
                <label for="vcard-url">Website</label>
                <input type="url" id="vcard-url" placeholder="https://www.example.com" maxlength="255">
            </div>
            <div class="input-group full-width">
                <label for="vcard-street">Street</label>
                <input type="text" id="vcard-street" placeholder="123 Main St" maxlength="100">
            </div>
            <div class="input-group">
                <label for="vcard-city">City</label>
                <input type="text" id="vcard-city" placeholder="Anytown" maxlength="50">
            </div>
            <div class="input-group">
                <label for="vcard-state">State/Province</label>
                <input type="text" id="vcard-state" placeholder="CA" maxlength="50">
            </div>
            <div class="input-group">
                <label for="vcard-zip">ZIP/Postal Code</label>
                <input type="text" id="vcard-zip" placeholder="90210">
            </div>
            <div class="input-group">
                <label for="vcard-country">Country</label>
                <input type="text" id="vcard-country" placeholder="USA" maxlength="50">
            </div>
        </div>
    </div>

    <!-- Tab Content: Wifi Input Form -->
    <div id="Wifi" class="tab-content">
        <div class="vcard-grid">
            <div class="input-group full-width">
                <label for="wifi-ssid">Network Name (SSID)</label>
                <input type="text" id="wifi-ssid" placeholder="e.g., MyHomeWiFi" maxlength="128">
            </div>
            <div class="input-group">
                <label for="wifi-password">Password</label>
                <input type="password" id="wifi-password" placeholder="Your secret password" maxlength="63">
            </div>
            <div class="input-group">
                <label for="wifi-auth">Authentication</label>
                <select id="wifi-auth">
                    <option value="WPA" selected>WPA/WPA2</option>
                    <option value="WEP">WEP</option>
                    <option value="nopass">None</option>
                </select>
            </div>
            <div class="input-group full-width checkbox-group">
                <input type="checkbox" id="wifi-hidden">
                <label for="wifi-hidden">This is a hidden network</label>
            </div>
            <div class="input-group full-width checkbox-group">
                <input type="checkbox" id="show-password">
                <label for="show-password">Show Password</label>
            </div>
        </div>
    </div>

    <!-- Tab Content: SMS/Phone Input Form -->
    <div id="SMSPhone" class="tab-content">
        <div class="vcard-grid">
            <div class="radio-group-container">
                <div class="radio-group">
                    <input type="radio" id="sms-type-sms" name="sms-phone-type" value="sms" checked>
                    <label for="sms-type-sms">SMS</label>
                </div>
                <div class="radio-group">
                    <input type="radio" id="sms-type-phone" name="sms-phone-type" value="phone">
                    <label for="sms-type-phone">Phone Call</label>
                </div>
            </div>
            <div class="input-group full-width">
                <label for="sms-phone-number">Phone Number</label>
                <input type="tel" id="sms-phone-number" placeholder="e.g., +15551234567" maxlength="30">
            </div>
            <div id="sms-message-group" class="input-group full-width">
                <label for="sms-message">Message (optional)</label>
                <textarea id="sms-message" rows="4" placeholder="Your pre-filled message here..." maxlength="300"></textarea>
                <div id="sms-char-count" class="char-counter">0 / 300 characters</div>
            </div>
        </div>
    </div>
    <!-- Common Controls -->
    <br>
    <label for="size-select">QR Code Size</label>
    <select id="size-select">
        <option value="5">Small (5)</option>
        <option value="10" selected>Medium (10)</option>
        <option value="15">Large (15)</option>
    </select>
    <button onclick="generateQRCode()">Create QR Code</button>
    
    <!-- QR Code Display Area -->
    <div id="qr-container">
        <p id="qr-placeholder">QR Code will appear here</p>
        <img id="qr-image" src="" alt="QR Code" style="display:none;">
        <p id="qr-code-text" style="display:none;"></p>
        <button id="download-btn" onclick="downloadQRCode()">Download QR Code</button>
    </div>

    <!-- Footer / Info Section -->
    <p style="font-size: 0.9em; color: #666; margin-top: 30px;">
        This tool runs entirely in your browser. No data is stored or sent anywhere.<br>
        No tracking, no ads, no nonsense.
        <br>
        <a href="https://github.com/timoheimonen/qrturbo" target="_blank" style="color: #007acc;">View source on GitHub</a>
    </p>
    <script src="js/qrcode.js"></script>
    <script>
        /**
         * @description Main function to generate the QR code based on the active tab and user input.
         */
        function generateQRCode() {
            let text;
            const activeTabButton = document.querySelector('.tab-link.active');
            if (!activeTabButton) return; // Exit if no active tab is found
            const activeTab = activeTabButton.dataset.tab;

            // --- Step 1: Gather data from the active tab ---
            if (activeTab === 'URLText') {
                text = document.getElementById('qr-text').value;
                if (!text) {
                    alert('Please enter some text or a URL');
                    return;
                }
            } else if (activeTab === 'VCard') { // VCard tab is active
                // Collect all vCard fields
                const vcard = {
                    fn: document.getElementById('vcard-fn').value.trim(),
                    ln: document.getElementById('vcard-ln').value.trim(),
                    org: document.getElementById('vcard-org').value.trim(),
                    title: document.getElementById('vcard-title').value.trim(),
                    telWork: document.getElementById('vcard-tel-work').value.trim(),
                    telMobile: document.getElementById('vcard-tel-mobile').value.trim(),
                    email: document.getElementById('vcard-email').value.trim(),
                    url: document.getElementById('vcard-url').value.trim(),
                    street: document.getElementById('vcard-street').value.trim(),
                    city: document.getElementById('vcard-city').value.trim(),
                    state: document.getElementById('vcard-state').value.trim(),
                    zip: document.getElementById('vcard-zip').value.trim(),
                    country: document.getElementById('vcard-country').value.trim(),
                };

                // Basic validation: ensure at least one key identifier is present
                if (!vcard.fn && !vcard.ln && !vcard.email && !vcard.telMobile && !vcard.telWork) {
                    alert('Please fill at least one of: First Name, Last Name, Email or Phone.');
                    return;
                }

                // Assemble the vCard string according to the vCard 3.0 format
                let vCardString = "BEGIN:VCARD\nVERSION:3.0\n";
                if (vcard.fn || vcard.ln) vCardString += `N:${vcard.ln};${vcard.fn}\n`;
                if (vcard.fn || vcard.ln) vCardString += `FN:${vcard.fn} ${vcard.ln}\n`;
                if (vcard.org) vCardString += `ORG:${vcard.org}\n`;
                if (vcard.title) vCardString += `TITLE:${vcard.title}\n`;
                if (vcard.telWork) vCardString += `TEL;TYPE=WORK,VOICE:${vcard.telWork}\n`;
                if (vcard.telMobile) vCardString += `TEL;TYPE=CELL,VOICE:${vcard.telMobile}\n`;
                if (vcard.email) vCardString += `EMAIL:${vcard.email}\n`;
                if (vcard.url) vCardString += `URL:${vcard.url}\n`;
                if (vcard.street || vcard.city || vcard.state || vcard.zip || vcard.country) {
                    vCardString += `ADR;TYPE=HOME:;;${vcard.street};${vcard.city};${vcard.state};${vcard.zip};${vcard.country}\n`;
                }
                vCardString += "END:VCARD";
                text = vCardString;
            } else if (activeTab === 'Wifi') { // Wifi tab is active
                const ssid = document.getElementById('wifi-ssid').value.trim();
                const password = document.getElementById('wifi-password').value; // No trim on password
                const authType = document.getElementById('wifi-auth').value;
                const isHidden = document.getElementById('wifi-hidden').checked;

                if (!ssid) {
                    alert('Please enter the Network Name (SSID).');
                    return;
                }

                // Escape special characters for the WIFI format: \, ;, ,, "
                const escapeWifi = (s) => s.replace(/([\\;,"])/g, '\\$1');

                let wifiString = `WIFI:S:${escapeWifi(ssid)};`;
                wifiString += `T:${authType};`;
                if (authType !== 'nopass') {
                    wifiString += `P:${escapeWifi(password)};`;
                }
                if (isHidden) {
                    wifiString += 'H:true;';
                }
                text = wifiString;
            } else if (activeTab === 'SMSPhone') { // SMS/Phone tab is active
                const type = document.querySelector('input[name="sms-phone-type"]:checked').value;
                const phoneNumber = document.getElementById('sms-phone-number').value.trim();

                if (!phoneNumber) {
                    alert('Please enter a phone number.');
                    return;
                }

                if (type === 'sms') {
                    const message = document.getElementById('sms-message').value; // Don't trim message
                    // Format: SMSTO:number:message
                    text = `SMSTO:${phoneNumber}:${message}`;
                } else { // type === 'phone'
                    text = `tel:${phoneNumber}`;
                }
            }
            
            if (!text) {
                // Fallback validation, though prior checks should prevent this.
                alert('No data provided for QR code.');
                return;
            }

            // --- Step 2: Prepare UI for generation (loading state) ---
            const qrContainer = document.getElementById('qr-container');
            const qrImage = document.getElementById('qr-image');
            const downloadBtn = document.getElementById('download-btn');
            const qrCodeText = document.getElementById('qr-code-text');
            const qrPlaceholder = document.getElementById('qr-placeholder');
            
            qrContainer.classList.add('loading');
            qrPlaceholder.style.display = 'none';
            qrImage.style.opacity = '0.3'; // Dim the old image while loading
            downloadBtn.style.display = 'none';
            qrCodeText.style.display = 'none';

            // Use a short timeout to allow the UI to update with the loading state before the (potentially blocking) QR generation.
            setTimeout(() => {
                // --- Step 3: Generate and display the QR code ---
                const sizeSelect = document.getElementById('size-select');
                const selectedSize = parseInt(sizeSelect.value);

                // Initialize QR code generator (type 0 = auto-detect, 'M' = medium error correction)
                const qr = qrcode(0, 'M');
                qr.addData(text);
                qr.make();

                // Set the generated QR code as a Data URL to the image element
                qrImage.src = qr.createDataURL(selectedSize);
                qrImage.style.display = 'block';
                qrImage.style.opacity = '1';
                
                // Display the raw text content of the QR code
                qrCodeText.textContent = text;
                qrCodeText.style.display = 'block';

                // --- Step 4: Finalize UI (remove loading state, show results) ---
                qrContainer.classList.remove('loading');
                downloadBtn.style.display = 'block';
                
                // Re-trigger the container's appearance animation for a nice effect
                qrContainer.style.animation = 'none';
                qrContainer.offsetHeight; // Force a DOM reflow to reset the animation
                qrContainer.style.animation = 'qrAppear 0.6s ease-out';
            }, 300);
        }

        /**
         * @description Handles downloading the generated QR code image.
         */
        function downloadQRCode() {
            const qrImage = document.getElementById('qr-image');
            const activeTabButton = document.querySelector('.tab-link.active');
            if (!activeTabButton) return;
            const activeTab = activeTabButton.dataset.tab;
            let text;
             // Generate a user-friendly filename based on the input
             if (activeTab === 'URLText') {
                text = document.getElementById('qr-text').value;
            } else if (activeTab === 'VCard') {
                const firstName = document.getElementById('vcard-fn').value;
                const lastName = document.getElementById('vcard-ln').value;
                text = `vcard_${firstName}_${lastName}`;
            } else if (activeTab === 'Wifi') {
                text = `wifi_${document.getElementById('wifi-ssid').value}`;
            } else if (activeTab === 'SMSPhone') {
                const type = document.querySelector('input[name="sms-phone-type"]:checked').value;
                const phoneNumber = document.getElementById('sms-phone-number').value;
                text = `${type}_${phoneNumber}`;
            }

            // Sanitize the text to create a safe filename
            const safeText = text.replace(/[^a-z0-9]/gi, '_').substring(0, 50) || 'qr';

            // Create a temporary anchor element to trigger the download
            const link = document.createElement('a');
            link.download = `qrcode_${safeText}.png`;
            link.href = qrImage.src;
            link.click();
            
            // Re-trigger the download button's animation for user feedback
            const downloadBtn = document.getElementById('download-btn');
            downloadBtn.style.animation = 'none';
            downloadBtn.offsetHeight; // Force reflow
            downloadBtn.style.animation = 'bounceIn 0.6s ease-out';
        }

        // Setup page logic after the DOM is fully loaded
        document.addEventListener('DOMContentLoaded', function() {
            // --- Element Selectors ---
            const tabsContainer = document.getElementById('tabs');
            const wifiAuthSelect = document.getElementById('wifi-auth');
            const wifiPasswordField = document.getElementById('wifi-password');
            const showPasswordCheckbox = document.getElementById('show-password');
            const smsPhoneTypeRadios = document.querySelectorAll('input[name="sms-phone-type"]');
            const smsMessageGroup = document.getElementById('sms-message-group');
            const qrTextInput = document.getElementById('qr-text');
            const charCountDisplay = document.getElementById('char-count');
            const smsMessageInput = document.getElementById('sms-message');
            const smsCharCountDisplay = document.getElementById('sms-char-count');

            // --- Event Listeners ---

            // Track character count for the URL/Text input
            qrTextInput.addEventListener('input', function() {
                const currentLength = this.value.length;
                charCountDisplay.textContent = `${currentLength} / 300 characters`;
                charCountDisplay.classList.toggle('warning', currentLength >= 250);
            });

            // Track character count for the SMS message input
            smsMessageInput.addEventListener('input', function() {
                const currentLength = this.value.length;
                smsCharCountDisplay.textContent = `${currentLength} / 300 characters`;
                smsCharCountDisplay.classList.toggle('warning', currentLength >= 250);
            });

            // Allow generating QR by pressing Enter in the text input
            qrTextInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    // Prevent form submission if it were inside a form
                    e.preventDefault(); 
                    generateQRCode();
                }
            });

            // Add a subtle scale effect on input focus for better UX
            document.querySelectorAll('input[type="text"], input[type="tel"], input[type="email"], input[type="url"], textarea').forEach(el => {
                el.addEventListener('focus', function() {
                    // The :focus CSS already handles this, but if you wanted JS-only:
                    // this.style.transform = 'scale(1.02)';
                });
                el.addEventListener('blur', function() {
                    // The :focus CSS already handles this, but if you wanted JS-only:
                    // this.style.transform = 'scale(1)';
                });
            });

            // --- SMS/Phone Form Logic ---
            function updateSmsPhoneUI() {
                const selectedType = document.querySelector('input[name="sms-phone-type"]:checked').value;
                const isSms = selectedType === 'sms';
                // Use 'flex' to match the .input-group display property
                smsMessageGroup.style.display = isSms ? 'flex' : 'none';
                if (!isSms) {
                    // Clear message when switching to phone call to avoid confusion
                    document.getElementById('sms-message').value = '';
                }
            }
            smsPhoneTypeRadios.forEach(radio => radio.addEventListener('change', updateSmsPhoneUI));
            // Set initial state on page load
            updateSmsPhoneUI();

            // --- Wifi Form Logic ---
            // Toggle password field enabled state based on authentication type
            wifiAuthSelect.addEventListener('change', function() {
                const isPasswordNeeded = this.value !== 'nopass';
                wifiPasswordField.disabled = !isPasswordNeeded;
                if (!isPasswordNeeded) {
                    wifiPasswordField.value = ''; // Clear password if not needed
                }
            });
            // Trigger change on load to set initial state
            wifiAuthSelect.dispatchEvent(new Event('change'));

            // Toggle password visibility
            showPasswordCheckbox.addEventListener('change', function() {
                wifiPasswordField.type = this.checked ? 'text' : 'password';
            });


            // --- Tab Switching Logic ---
            tabsContainer.addEventListener('click', function(event) {
                const clickedTab = event.target.closest('.tab-link');
                // Ignore clicks that are not on a a tab link or are on the already active tab
                if (!clickedTab || clickedTab.classList.contains('active')) {
                    return;
                }

                const tabName = clickedTab.dataset.tab;

                tabsContainer.querySelector('.active').classList.remove('active');
                clickedTab.classList.add('active');

                document.querySelectorAll('.tab-content').forEach(content => {
                    content.style.display = 'none';
                });
                document.getElementById(tabName).style.display = 'block';

                // --- Reset UI state when switching tabs ---
                // Clear all input fields
                const allFormElements = document.querySelectorAll('.tab-content input, .tab-content textarea');
                allFormElements.forEach(input => {
                    if (input.type === 'checkbox' || input.type === 'radio') {
                        input.checked = false;
                    } else {
                        input.value = '';
                    }
                });
                // Reset select elements in all tabs to their first option
                document.querySelectorAll('.tab-content select').forEach(select => select.selectedIndex = 0);

                // Manually set default states for specific controls after clearing
                document.getElementById('sms-type-sms').checked = true;

                // Manually trigger change events to reset dependent UI states
                document.getElementById('wifi-auth').dispatchEvent(new Event('change'));
                updateSmsPhoneUI();
                // Reset password field to be of type 'password'
                document.getElementById('wifi-password').type = 'password';

                // Reset character counters
                const charCountDisplay = document.getElementById('char-count');
                charCountDisplay.textContent = '0 / 300 characters';
                charCountDisplay.classList.remove('warning');
                const smsCharCountDisplay = document.getElementById('sms-char-count');
                smsCharCountDisplay.textContent = '0 / 300 characters';
                smsCharCountDisplay.classList.remove('warning');

                const qrContainer = document.getElementById('qr-container');
                const qrImage = document.getElementById('qr-image');
                const downloadBtn = document.getElementById('download-btn');
                const qrCodeText = document.getElementById('qr-code-text');
                const qrPlaceholder = document.getElementById('qr-placeholder');
                
                qrPlaceholder.style.display = 'block';
                qrImage.src = "";
                qrImage.style.display = 'none';
                downloadBtn.style.display = 'none';
                qrCodeText.style.display = 'none';
                qrContainer.classList.remove('loading');

                // Reset container animation to its initial slide-in state
                qrContainer.style.animation = 'none';
                qrContainer.offsetHeight; // Force reflow
                qrContainer.style.animation = 'slideInUp 0.8s ease-out 0.3s both';
            });

            // Apply a staggered animation delay to elements on page load for a smoother appearance
            const elements = document.querySelectorAll('input, button, select, textarea, .char-counter, .tab-link');
            elements.forEach((element, index) => element.style.animationDelay = `${0.1 + (index * 0.05)}s`);
        });
    </script>
</body>
</html>